The following views must be added after bundle exec rake db:migrate

alter view ordered_records as
select mr.*,(mr.id + (mt.PercentageID * 1000)) as 'rank' from milestone_records mr inner join milestone_tasks mt on mr.milestone_tasks_id = mt.id
where mr.id not in (select id from record_parents)
union all
select * from record_parents

alter view record_parents as
select mr2.*, ((mr.id + (mt.PercentageID * 1000)) + 1) as 'rank' from milestone_records mr inner join milestone_tasks mt on mr.milestone_tasks_id = mt.id 
inner join milestone_records mr2 on mt.ParentMilestoneTaskID = mr2.milestone_tasks_id and mr2.jobs_id = mr.jobs_id


Also have to change the one column on milestone_records